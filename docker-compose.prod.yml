services:
  gcc-mcp:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: gcc-server
    restart: always
    env_file:
      - .env
    environment:
      # Essencial para aceitar tráfego do Traefik internamente
      GCC_MCP_ALLOW_PUBLIC_HTTP: 'true'
    volumes:
      # Chaves de segurança (somente leitura)
      - ./secrets:/app/secrets:ro
      # Mapeie aqui a pasta real da sua VPS onde estão os projetos que a IA vai editar
      - /root/PROJETOS:/workspace/repos
    networks:
      - web
    labels:
      - 'traefik.enable=true'
      - 'traefik.docker.network=web'
      - 'traefik.http.routers.gcc.rule=Host(`gcc.gtmedics.com`)' # Ajuste seu subdomínio
      - 'traefik.http.routers.gcc.entrypoints=websecure'
      - 'traefik.http.routers.gcc.tls.certresolver=mytlschallenge'
      - 'traefik.http.services.gcc.loadbalancer.server.port=8000'

networks:
  web:
    external: true
