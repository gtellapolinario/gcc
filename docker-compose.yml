services:
  gcc-mcp:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    image: gcc-mcp:dev
    container_name: gcc-mcp-dev
    command:
      - --transport
      - streamable-http
      - --host
      - 0.0.0.0
      - --port
      - "8000"
      - --allow-public-http
    environment:
      PYTHONUNBUFFERED: "1"
      GCC_MCP_AUDIT_REDACT: "true"
      GCC_MCP_PATH_MAP: ${GCC_MCP_PATH_MAP:-}
      GCC_MCP_ALLOWED_ROOTS: ${GCC_MCP_ALLOWED_ROOTS:-}
    ports:
      - "127.0.0.1:8000:8000"
    volumes:
      - gcc-dev-workspace:/workspace
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "python -c \"import socket; s=socket.socket(); s.settimeout(2); s.connect(('127.0.0.1', 8000)); s.close()\"",
        ]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

volumes:
  gcc-dev-workspace:
